"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs = __importStar(require("fs"));
const Validator_1 = global[Symbol.for('ioc.use')]("Adonis/Core/Validator");
const Prisma_1 = global[Symbol.for('ioc.use')]("Adonis/Addons/Prisma");
const exceljs_1 = __importDefault(require("exceljs"));
const Logger_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Core/Logger"));
class CursosController {
    async index({ request, response }) {
        const pagina = parseInt(request.input('pagina') || 1);
        const porPagina = parseInt(request.input('porPagina') || 8);
        const buscar = request.input('buscar') || '';
        const combo = JSON.parse(request.input('combo') || false);
        const filtroIdioma = request.input('idiomaId') || '';
        const filialId = request.input('filialId') || '';
        if (filialId == '') {
            return response.status(422).send({
                message: 'Debe seleccionar una filial',
            });
        }
        if (filtroIdioma === '') {
            if (combo) {
                return response.send({
                    message: 'Lista de registros',
                    payload: await Prisma_1.prisma.curso.findMany({
                        where: {
                            filial: {
                                id: filialId,
                            },
                        },
                        orderBy: [
                            { nombre: 'asc' },
                        ],
                        include: {
                            idioma: true,
                            modalidad: true,
                            niveles: {
                                include: {
                                    libros: {
                                        orderBy: [
                                            { nombre: 'asc' },
                                        ],
                                    },
                                },
                            },
                        },
                    }),
                });
            }
            else {
                const [data, total] = await Prisma_1.prisma.$transaction([
                    Prisma_1.prisma.curso.findMany({
                        skip: (pagina - 1) * porPagina,
                        take: porPagina,
                        include: {
                            idioma: true,
                            modalidad: true,
                        },
                        orderBy: [
                            { nombre: 'asc' },
                        ],
                        where: {
                            filial: {
                                id: filialId,
                            },
                            OR: [
                                {
                                    nombre: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                },
                            ],
                        },
                    }),
                    Prisma_1.prisma.curso.count({
                        where: {
                            filial: {
                                id: filialId,
                            },
                            OR: [
                                {
                                    nombre: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                },
                            ],
                        },
                    })
                ]);
                return response.send({
                    message: 'Lista de registros',
                    payload: {
                        data: data,
                        meta: {
                            lastPage: Math.ceil(total / porPagina),
                            total: total,
                        }
                    },
                });
            }
        }
        else {
            if (combo) {
                return response.send({
                    message: 'Lista de registros',
                    payload: await Prisma_1.prisma.curso.findMany({
                        orderBy: [
                            { nombre: 'asc' },
                        ],
                        include: {
                            idioma: true,
                            modalidad: true,
                            niveles: {
                                include: {
                                    libros: {
                                        orderBy: [
                                            { nombre: 'asc' },
                                        ],
                                    },
                                },
                            },
                        },
                        where: {
                            filial: {
                                id: filialId,
                            },
                            idioma: {
                                id: filtroIdioma,
                            },
                        },
                    }),
                });
            }
            else {
                const [data, total] = await Prisma_1.prisma.$transaction([
                    Prisma_1.prisma.curso.findMany({
                        skip: (pagina - 1) * porPagina,
                        take: porPagina,
                        include: {
                            idioma: true,
                            modalidad: true,
                        },
                        orderBy: [
                            { nombre: 'asc' },
                        ],
                        where: {
                            filial: {
                                id: filialId,
                            },
                            idioma: {
                                id: filtroIdioma,
                            },
                            nombre: {
                                contains: buscar,
                                mode: 'insensitive',
                            },
                        },
                    }),
                    Prisma_1.prisma.curso.count({
                        where: {
                            filial: {
                                id: filialId,
                            },
                            idioma: {
                                id: filtroIdioma,
                            },
                            nombre: {
                                contains: buscar,
                                mode: 'insensitive',
                            },
                        },
                    })
                ]);
                return response.send({
                    message: 'Lista de registros',
                    payload: {
                        data: data,
                        meta: {
                            lastPage: Math.ceil(total / porPagina),
                            total: total,
                        }
                    },
                });
            }
        }
    }
    async store({ request, response }) {
        const payload = await request.validate({
            schema: Validator_1.schema.create({
                nombre: Validator_1.schema.string([
                    Validator_1.rules.maxLength(255),
                    Validator_1.rules.trim(),
                ]),
                activo: Validator_1.schema.boolean(),
                horaInicial: Validator_1.schema.string([
                    Validator_1.rules.time()
                ]),
                horaFinal: Validator_1.schema.string([
                    Validator_1.rules.time()
                ]),
                filialId: Validator_1.schema.string(),
                idiomaId: Validator_1.schema.string(),
                modalidadId: Validator_1.schema.string(),
                niveles: Validator_1.schema.array([
                    Validator_1.rules.minLength(1),
                ]).members(Validator_1.schema.string()),
            }),
        });
        try {
            return response.send({
                message: 'Registro almacenado',
                payload: await Prisma_1.prisma.curso.create({
                    data: {
                        nombre: payload.nombre,
                        activo: true,
                        modalidad: {
                            connect: { id: payload.modalidadId },
                        },
                        idioma: {
                            connect: { id: payload.idiomaId },
                        },
                        filial: {
                            connect: { id: payload.filialId },
                        },
                        horaInicial: payload.horaInicial,
                        horaFinal: payload.horaFinal,
                        niveles: {
                            connect: payload.niveles.map(o => ({ id: o })),
                        },
                    },
                }),
            });
        }
        catch (err) {
            Logger_1.default.error(err);
            return response.status(500).send({
                message: 'Error al almacenar el registro',
            });
        }
    }
    async show({ request, response }) {
        try {
            return response.send({
                message: 'Detalle del registro',
                payload: await Prisma_1.prisma.curso.findUniqueOrThrow({
                    where: {
                        id: request.param('id'),
                    },
                    include: {
                        idioma: true,
                        modalidad: true,
                        niveles: {
                            include: {
                                libros: {
                                    orderBy: [
                                        { nombre: 'asc' },
                                    ],
                                },
                            },
                        },
                    },
                }),
            });
        }
        catch (err) {
            Logger_1.default.error(err);
            return response.status(404).send({
                message: 'Registro inexistente',
            });
        }
    }
    async update({ request, response }) {
        if ((await Prisma_1.prisma.curso.count({
            where: {
                id: request.param('id'),
            },
        })) !== 1) {
            return response.status(404).send({
                message: 'Registro inexistente',
            });
        }
        const payload = await request.validate({
            schema: Validator_1.schema.create({
                nombre: Validator_1.schema.string([
                    Validator_1.rules.maxLength(255),
                    Validator_1.rules.trim(),
                ]),
                activo: Validator_1.schema.boolean(),
                horaInicial: Validator_1.schema.string([
                    Validator_1.rules.time()
                ]),
                horaFinal: Validator_1.schema.string([
                    Validator_1.rules.time()
                ]),
                filialId: Validator_1.schema.string(),
                idiomaId: Validator_1.schema.string(),
                modalidadId: Validator_1.schema.string(),
                niveles: Validator_1.schema.array([
                    Validator_1.rules.minLength(1),
                ]).members(Validator_1.schema.string()),
            }),
        });
        try {
            return response.send({
                message: 'Registro actualizado',
                payload: await Prisma_1.prisma.curso.update({
                    where: {
                        id: request.param('id'),
                    },
                    data: {
                        nombre: payload.nombre,
                        activo: payload.activo,
                        modalidad: {
                            connect: { id: payload.modalidadId },
                        },
                        idioma: {
                            connect: { id: payload.idiomaId },
                        },
                        filial: {
                            connect: { id: payload.filialId },
                        },
                        horaInicial: payload.horaInicial,
                        horaFinal: payload.horaFinal,
                        niveles: {
                            set: payload.niveles.map(o => ({ id: o })),
                        },
                    },
                }),
            });
        }
        catch (err) {
            Logger_1.default.error(err);
            return response.status(500).send({
                message: 'Error al almacenar el registro',
            });
        }
    }
    async destroy({ request, response }) {
        if ((await Prisma_1.prisma.curso.count({
            where: {
                id: request.param('id'),
            },
        })) !== 1) {
            return response.status(404).send({
                message: 'Registro inexistente',
            });
        }
        await Prisma_1.prisma.curso.update({
            where: {
                id: request.param('id'),
            },
            data: {
                niveles: {
                    set: [],
                },
            },
        });
        await Prisma_1.prisma.curso.delete({
            where: {
                id: request.param('id'),
            },
        });
        return response.send({
            message: 'Registro eliminado',
        });
    }
    async excel({ request, response }) {
        const filialId = request.input('filialId') || '';
        if (filialId == '') {
            return response.status(422).send({
                message: 'Debe seleccionar una filial',
            });
        }
        const dir = './tmp/uploads/excel';
        if (!fs.existsSync(dir)) {
            fs.mkdirSync(dir, { recursive: true });
        }
        const archivo = `cursos_${Math.floor(new Date().getTime() / 1000)}.xlsx`;
        const libro = new exceljs_1.default.Workbook();
        const hoja = libro.addWorksheet('Cursos');
        hoja.columns = [
            { key: 'idiomaNombre', header: 'Idioma', },
            { key: 'modalidadNombre', header: 'Modalidad', },
            { key: 'nombre', header: 'Nombre', },
            { key: 'horaInicial', header: 'Hora Inicial', },
            { key: 'horaFinal', header: 'Hora Final', },
            { key: 'estado', header: 'Estado', },
            { key: 'nivelesLista', header: 'Niveles', },
            { key: 'librosLista', header: 'Libros', },
        ];
        hoja.getRow(1).font = {
            bold: true,
        };
        (await Prisma_1.prisma.curso.findMany({
            where: {
                filial: {
                    id: filialId,
                },
            },
            include: {
                idioma: true,
                modalidad: true,
                niveles: {
                    include: {
                        libros: {
                            orderBy: [
                                { nombre: 'asc' },
                            ],
                        },
                    },
                },
            },
        })).forEach(item => {
            let librosCurso = [];
            item.niveles.forEach(nivel => {
                librosCurso.push(nivel.libros.reduce(function (acc, o) {
                    acc.push(o.nombre);
                    return acc;
                }, []));
            });
            const librosLista = librosCurso.flat(1).filter((value, index, array) => array.indexOf(value) === index).join(', ');
            hoja.addRow({
                idiomaNombre: item.idioma.nombre,
                modalidadNombre: item.modalidad.nombre,
                nombre: item.nombre,
                horaInicial: item.horaInicial,
                horaFinal: item.horaFinal,
                estado: item.activo ? 'EN CURSO' : 'FINALIZADO',
                nivelesLista: item.niveles.reduce(function (acc, o) {
                    acc.push(o.nombre);
                    return acc;
                }, []).join(', '),
                librosLista: librosLista,
            });
        });
        await response.header('content-type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
        await response.header('content-disposition', `attachment; filename=${archivo}`);
        await libro.xlsx.writeFile(`${dir}/${archivo}`);
        return response.download(`${dir}/${archivo}`, true, (err) => {
            if (err) {
                Logger_1.default.error(err.message);
                return response.status(500).send({
                    message: 'Error al generar el archivo',
                });
            }
            fs.unlinkSync(`${dir}/${archivo}`);
        });
    }
}
exports.default = CursosController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3Vyc29zQ29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkN1cnNvc0NvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHVDQUF3QjtBQUV4QiwyRUFBMEQ7QUFDMUQsdUVBQWtEO0FBQ2xELHNEQUEyQjtBQUMzQixzRkFBNEM7QUFFNUMsTUFBcUIsZ0JBQWdCO0lBQzVCLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUF1QjtRQUMzRCxNQUFNLE1BQU0sR0FBVyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUM3RCxNQUFNLFNBQVMsR0FBVyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUNuRSxNQUFNLE1BQU0sR0FBVyxPQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtRQUNwRCxNQUFNLEtBQUssR0FBWSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUE7UUFDbEUsTUFBTSxZQUFZLEdBQVcsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDNUQsTUFBTSxRQUFRLEdBQVcsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDeEQsSUFBSSxRQUFRLElBQUksRUFBRSxFQUFFO1lBQ2xCLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQy9CLE9BQU8sRUFBRSw2QkFBNkI7YUFDdkMsQ0FBQyxDQUFBO1NBQ0g7UUFFRCxJQUFJLFlBQVksS0FBSyxFQUFFLEVBQUU7WUFDdkIsSUFB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TyxHQUFHLENBQUE7Z0JBQ1osQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ2pCLFdBQVcsRUFBRSxXQUFXO2FBQ3pCLENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQyxDQUFBO1FBQ0YsTUFBTSxRQUFRLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxtRUFBbUUsQ0FBQyxDQUFBO1FBQzFHLE1BQU0sUUFBUSxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSx3QkFBd0IsT0FBTyxFQUFFLENBQUMsQ0FBQTtRQUMvRSxNQUFNLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDLENBQUE7UUFDL0MsT0FBTyxRQUFRLENBQUMsUUFBUSxDQUFDLEdBQUcsR0FBRyxJQUFJLE9BQU8sRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQzFELElBQUksR0FBRyxFQUFFO2dCQUNQLGdCQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtnQkFDekIsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDL0IsT0FBTyxFQUFFLDZCQUE2QjtpQkFDdkMsQ0FBQyxDQUFBO2FBQ0g7WUFDRCxFQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDLENBQUE7UUFDcEMsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0Y7QUFqY0QsbUNBaWNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnXG5pbXBvcnQgdHlwZSB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xuaW1wb3J0IHsgc2NoZW1hLCBydWxlcyB9IGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvVmFsaWRhdG9yJ1xuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnQGlvYzpBZG9uaXMvQWRkb25zL1ByaXNtYSdcbmltcG9ydCBFeGNlbCBmcm9tICdleGNlbGpzJ1xuaW1wb3J0IExvZ2dlciBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0xvZ2dlcidcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3Vyc29zQ29udHJvbGxlciB7XG4gIHB1YmxpYyBhc3luYyBpbmRleCh7IHJlcXVlc3QsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICBjb25zdCBwYWdpbmE6IG51bWJlciA9IHBhcnNlSW50KHJlcXVlc3QuaW5wdXQoJ3BhZ2luYScpIHx8IDEpXG4gICAgY29uc3QgcG9yUGFnaW5hOiBudW1iZXIgPSBwYXJzZUludChyZXF1ZXN0LmlucHV0KCdwb3JQYWdpbmEnKSB8fCA4KVxuICAgIGNvbnN0IGJ1c2Nhcjogc3RyaW5nID0gcmVxdWVzdC5pbnB1dCgnYnVzY2FyJykgfHwgJydcbiAgICBjb25zdCBjb21ibzogYm9vbGVhbiA9IEpTT04ucGFyc2UocmVxdWVzdC5pbnB1dCgnY29tYm8nKSB8fCBmYWxzZSlcbiAgICBjb25zdCBmaWx0cm9JZGlvbWE6IHN0cmluZyA9IHJlcXVlc3QuaW5wdXQoJ2lkaW9tYUlkJykgfHwgJydcbiAgICBjb25zdCBmaWxpYWxJZDogc3RyaW5nID0gcmVxdWVzdC5pbnB1dCgnZmlsaWFsSWQnKSB8fCAnJ1xuICAgIGlmIChmaWxpYWxJZCA9PSAnJykge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MjIpLnNlbmQoe1xuICAgICAgICBtZXNzYWdlOiAnRGViZSBzZWxlY2Npb25hciB1bmEgZmlsaWFsJyxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYgKGZpbHRyb0lkaW9tYSA9PT0gJycpIHtcbiAgICAgIGlmIChjb21ibykge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc2VuZCh7XG4gICAgICAgICAgbWVzc2FnZTogJ0xpc3RhIGRlIHJlZ2lzdHJvcycsXG4gICAgICAgICAgcGF5bG9hZDogYXdhaXQgcHJpc21hLmN1cnNvLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIGZpbGlhbDoge1xuICAgICAgICAgICAgICAgIGlkOiBmaWxpYWxJZCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlckJ5OiBbXG4gICAgICAgICAgICAgIHsgbm9tYnJlOiAnYXNjJyB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgaWRpb21hOiB0cnVlLFxuICAgICAgICAgICAgICBtb2RhbGlkYWQ6IHRydWUsXG4gICAgICAgICAgICAgIG5pdmVsZXM6IHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICBsaWJyb3M6IHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgICAgICAgICAgICAgIHsgbm9tYnJlOiAnYXNjJyB9LFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IFsgZGF0YSwgdG90YWwgXSA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oW1xuICAgICAgICAgIHByaXNtYS5jdXJzby5maW5kTWFueSh7XG4gICAgICAgICAgICBza2lwOiAocGFnaW5hIC0gMSkgKiBwb3JQYWdpbmEsXG4gICAgICAgICAgICB0YWtlOiBwb3JQYWdpbmEsXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIGlkaW9tYTogdHJ1ZSxcbiAgICAgICAgICAgICAgbW9kYWxpZGFkOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICAgICAgeyBub21icmU6ICdhc2MnIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgZmlsaWFsOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGZpbGlhbElkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIG5vbWJyZToge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBwcmlzbWEuY3Vyc28uY291bnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgZmlsaWFsOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGZpbGlhbElkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIG5vbWJyZToge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICBdKVxuICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc2VuZCh7XG4gICAgICAgICAgbWVzc2FnZTogJ0xpc3RhIGRlIHJlZ2lzdHJvcycsXG4gICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgIG1ldGE6IHtcbiAgICAgICAgICAgICAgbGFzdFBhZ2U6IE1hdGguY2VpbCh0b3RhbC9wb3JQYWdpbmEpLFxuICAgICAgICAgICAgICB0b3RhbDogdG90YWwsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGNvbWJvKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5zZW5kKHtcbiAgICAgICAgICBtZXNzYWdlOiAnTGlzdGEgZGUgcmVnaXN0cm9zJyxcbiAgICAgICAgICBwYXlsb2FkOiBhd2FpdCBwcmlzbWEuY3Vyc28uZmluZE1hbnkoe1xuICAgICAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgICAgICB7IG5vbWJyZTogJ2FzYycgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIGlkaW9tYTogdHJ1ZSxcbiAgICAgICAgICAgICAgbW9kYWxpZGFkOiB0cnVlLFxuICAgICAgICAgICAgICBuaXZlbGVzOiB7XG4gICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgbGlicm9zOiB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICAgICAgICAgICAgICB7IG5vbWJyZTogJ2FzYycgfSxcbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBmaWxpYWw6IHtcbiAgICAgICAgICAgICAgICBpZDogZmlsaWFsSWQsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGlkaW9tYToge1xuICAgICAgICAgICAgICAgIGlkOiBmaWx0cm9JZGlvbWEsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgWyBkYXRhLCB0b3RhbCBdID0gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihbXG4gICAgICAgICAgcHJpc21hLmN1cnNvLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHNraXA6IChwYWdpbmEgLSAxKSAqIHBvclBhZ2luYSxcbiAgICAgICAgICAgIHRha2U6IHBvclBhZ2luYSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgaWRpb21hOiB0cnVlLFxuICAgICAgICAgICAgICBtb2RhbGlkYWQ6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgICAgICB7IG5vbWJyZTogJ2FzYycgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBmaWxpYWw6IHtcbiAgICAgICAgICAgICAgICBpZDogZmlsaWFsSWQsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGlkaW9tYToge1xuICAgICAgICAgICAgICAgIGlkOiBmaWx0cm9JZGlvbWEsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG5vbWJyZToge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBidXNjYXIsXG4gICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgICAgcHJpc21hLmN1cnNvLmNvdW50KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIGZpbGlhbDoge1xuICAgICAgICAgICAgICAgIGlkOiBmaWxpYWxJZCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgaWRpb21hOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGZpbHRyb0lkaW9tYSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbm9tYnJlOiB7XG4gICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICBdKVxuICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc2VuZCh7XG4gICAgICAgICAgbWVzc2FnZTogJ0xpc3RhIGRlIHJlZ2lzdHJvcycsXG4gICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgIG1ldGE6IHtcbiAgICAgICAgICAgICAgbGFzdFBhZ2U6IE1hdGguY2VpbCh0b3RhbC9wb3JQYWdpbmEpLFxuICAgICAgICAgICAgICB0b3RhbDogdG90YWwsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc3RvcmUoeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IHJlcXVlc3QudmFsaWRhdGUoe1xuICAgICAgc2NoZW1hOiBzY2hlbWEuY3JlYXRlKHtcbiAgICAgICAgbm9tYnJlOiBzY2hlbWEuc3RyaW5nKFtcbiAgICAgICAgICBydWxlcy5tYXhMZW5ndGgoMjU1KSxcbiAgICAgICAgICBydWxlcy50cmltKCksXG4gICAgICAgIF0pLFxuICAgICAgICBhY3Rpdm86IHNjaGVtYS5ib29sZWFuKCksXG4gICAgICAgIGhvcmFJbmljaWFsOiBzY2hlbWEuc3RyaW5nKFtcbiAgICAgICAgICBydWxlcy50aW1lKClcbiAgICAgICAgXSksXG4gICAgICAgIGhvcmFGaW5hbDogc2NoZW1hLnN0cmluZyhbXG4gICAgICAgICAgcnVsZXMudGltZSgpXG4gICAgICAgIF0pLFxuICAgICAgICBmaWxpYWxJZDogc2NoZW1hLnN0cmluZygpLFxuICAgICAgICBpZGlvbWFJZDogc2NoZW1hLnN0cmluZygpLFxuICAgICAgICBtb2RhbGlkYWRJZDogc2NoZW1hLnN0cmluZygpLFxuICAgICAgICBuaXZlbGVzOiBzY2hlbWEuYXJyYXkoW1xuICAgICAgICAgIHJ1bGVzLm1pbkxlbmd0aCgxKSxcbiAgICAgICAgXSkubWVtYmVycyhcbiAgICAgICAgICBzY2hlbWEuc3RyaW5nKCksXG4gICAgICAgICksXG4gICAgICB9KSxcbiAgICB9KVxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc2VuZCh7XG4gICAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBhbG1hY2VuYWRvJyxcbiAgICAgICAgcGF5bG9hZDogYXdhaXQgcHJpc21hLmN1cnNvLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgbm9tYnJlOiBwYXlsb2FkLm5vbWJyZSxcbiAgICAgICAgICAgIGFjdGl2bzogdHJ1ZSxcbiAgICAgICAgICAgIG1vZGFsaWRhZDoge1xuICAgICAgICAgICAgICBjb25uZWN0OiB7IGlkOiBwYXlsb2FkLm1vZGFsaWRhZElkIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWRpb21hOiB7XG4gICAgICAgICAgICAgIGNvbm5lY3Q6IHsgaWQ6IHBheWxvYWQuaWRpb21hSWQgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaWxpYWw6IHtcbiAgICAgICAgICAgICAgY29ubmVjdDogeyBpZDogcGF5bG9hZC5maWxpYWxJZCB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhvcmFJbmljaWFsOiBwYXlsb2FkLmhvcmFJbmljaWFsLFxuICAgICAgICAgICAgaG9yYUZpbmFsOiBwYXlsb2FkLmhvcmFGaW5hbCxcbiAgICAgICAgICAgIG5pdmVsZXM6IHtcbiAgICAgICAgICAgICAgY29ubmVjdDogcGF5bG9hZC5uaXZlbGVzLm1hcChvID0+ICh7IGlkOiBvIH0pKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICB9KVxuICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICBMb2dnZXIuZXJyb3IoZXJyKVxuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg1MDApLnNlbmQoe1xuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgYWxtYWNlbmFyIGVsIHJlZ2lzdHJvJyxcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHNob3coeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiByZXNwb25zZS5zZW5kKHtcbiAgICAgICAgbWVzc2FnZTogJ0RldGFsbGUgZGVsIHJlZ2lzdHJvJyxcbiAgICAgICAgcGF5bG9hZDogYXdhaXQgcHJpc21hLmN1cnNvLmZpbmRVbmlxdWVPclRocm93KHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgaWQ6IHJlcXVlc3QucGFyYW0oJ2lkJyksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBpZGlvbWE6IHRydWUsXG4gICAgICAgICAgICBtb2RhbGlkYWQ6IHRydWUsXG4gICAgICAgICAgICBuaXZlbGVzOiB7XG4gICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBsaWJyb3M6IHtcbiAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICAgICAgICAgICAgeyBub21icmU6ICdhc2MnIH0sXG4gICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSlcbiAgICB9IGNhdGNoKGVycikge1xuICAgICAgTG9nZ2VyLmVycm9yKGVycilcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDA0KS5zZW5kKHtcbiAgICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJvIGluZXhpc3RlbnRlJyxcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHVwZGF0ZSh7IHJlcXVlc3QsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICBpZiAoKGF3YWl0IHByaXNtYS5jdXJzby5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogcmVxdWVzdC5wYXJhbSgnaWQnKSxcbiAgICAgIH0sXG4gICAgfSkpICE9PSAxKSB7XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwNCkuc2VuZCh7XG4gICAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBpbmV4aXN0ZW50ZScsXG4gICAgICB9KVxuICAgIH1cbiAgICBjb25zdCBwYXlsb2FkID0gYXdhaXQgcmVxdWVzdC52YWxpZGF0ZSh7XG4gICAgICBzY2hlbWE6IHNjaGVtYS5jcmVhdGUoe1xuICAgICAgICBub21icmU6IHNjaGVtYS5zdHJpbmcoW1xuICAgICAgICAgIHJ1bGVzLm1heExlbmd0aCgyNTUpLFxuICAgICAgICAgIHJ1bGVzLnRyaW0oKSxcbiAgICAgICAgXSksXG4gICAgICAgIGFjdGl2bzogc2NoZW1hLmJvb2xlYW4oKSxcbiAgICAgICAgaG9yYUluaWNpYWw6IHNjaGVtYS5zdHJpbmcoW1xuICAgICAgICAgIHJ1bGVzLnRpbWUoKVxuICAgICAgICBdKSxcbiAgICAgICAgaG9yYUZpbmFsOiBzY2hlbWEuc3RyaW5nKFtcbiAgICAgICAgICBydWxlcy50aW1lKClcbiAgICAgICAgXSksXG4gICAgICAgIGZpbGlhbElkOiBzY2hlbWEuc3RyaW5nKCksXG4gICAgICAgIGlkaW9tYUlkOiBzY2hlbWEuc3RyaW5nKCksXG4gICAgICAgIG1vZGFsaWRhZElkOiBzY2hlbWEuc3RyaW5nKCksXG4gICAgICAgIG5pdmVsZXM6IHNjaGVtYS5hcnJheShbXG4gICAgICAgICAgcnVsZXMubWluTGVuZ3RoKDEpLFxuICAgICAgICBdKS5tZW1iZXJzKFxuICAgICAgICAgIHNjaGVtYS5zdHJpbmcoKSxcbiAgICAgICAgKSxcbiAgICAgIH0pLFxuICAgIH0pXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiByZXNwb25zZS5zZW5kKHtcbiAgICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJvIGFjdHVhbGl6YWRvJyxcbiAgICAgICAgcGF5bG9hZDogYXdhaXQgcHJpc21hLmN1cnNvLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIGlkOiByZXF1ZXN0LnBhcmFtKCdpZCcpLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgbm9tYnJlOiBwYXlsb2FkLm5vbWJyZSxcbiAgICAgICAgICAgIGFjdGl2bzogcGF5bG9hZC5hY3Rpdm8sXG4gICAgICAgICAgICBtb2RhbGlkYWQ6IHtcbiAgICAgICAgICAgICAgY29ubmVjdDogeyBpZDogcGF5bG9hZC5tb2RhbGlkYWRJZCB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlkaW9tYToge1xuICAgICAgICAgICAgICBjb25uZWN0OiB7IGlkOiBwYXlsb2FkLmlkaW9tYUlkIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmlsaWFsOiB7XG4gICAgICAgICAgICAgIGNvbm5lY3Q6IHsgaWQ6IHBheWxvYWQuZmlsaWFsSWQgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBob3JhSW5pY2lhbDogcGF5bG9hZC5ob3JhSW5pY2lhbCxcbiAgICAgICAgICAgIGhvcmFGaW5hbDogcGF5bG9hZC5ob3JhRmluYWwsXG4gICAgICAgICAgICBuaXZlbGVzOiB7XG4gICAgICAgICAgICAgIHNldDogcGF5bG9hZC5uaXZlbGVzLm1hcChvID0+ICh7IGlkOiBvIH0pKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICB9KVxuICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICBMb2dnZXIuZXJyb3IoZXJyKVxuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg1MDApLnNlbmQoe1xuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgYWxtYWNlbmFyIGVsIHJlZ2lzdHJvJyxcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIGRlc3Ryb3koeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgaWYgKChhd2FpdCBwcmlzbWEuY3Vyc28uY291bnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IHJlcXVlc3QucGFyYW0oJ2lkJyksXG4gICAgICB9LFxuICAgIH0pKSAhPT0gMSkge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoe1xuICAgICAgICBtZXNzYWdlOiAnUmVnaXN0cm8gaW5leGlzdGVudGUnLFxuICAgICAgfSlcbiAgICB9XG4gICAgYXdhaXQgcHJpc21hLmN1cnNvLnVwZGF0ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogcmVxdWVzdC5wYXJhbSgnaWQnKSxcbiAgICAgIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG5pdmVsZXM6IHtcbiAgICAgICAgICBzZXQ6IFtdLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KVxuICAgIGF3YWl0IHByaXNtYS5jdXJzby5kZWxldGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IHJlcXVlc3QucGFyYW0oJ2lkJyksXG4gICAgICB9LFxuICAgIH0pXG4gICAgcmV0dXJuIHJlc3BvbnNlLnNlbmQoe1xuICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJvIGVsaW1pbmFkbycsXG4gICAgfSlcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBleGNlbCh7IHJlcXVlc3QsIHJlc3BvbnNlIH0pIHtcbiAgICBjb25zdCBmaWxpYWxJZDogc3RyaW5nID0gcmVxdWVzdC5pbnB1dCgnZmlsaWFsSWQnKSB8fCAnJ1xuICAgIGlmIChmaWxpYWxJZCA9PSAnJykge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MjIpLnNlbmQoe1xuICAgICAgICBtZXNzYWdlOiAnRGViZSBzZWxlY2Npb25hciB1bmEgZmlsaWFsJyxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZGlyID0gJy4vdG1wL3VwbG9hZHMvZXhjZWwnXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGRpcikpe1xuICAgICAgZnMubWtkaXJTeW5jKGRpciwgeyByZWN1cnNpdmU6IHRydWUgfSlcbiAgICB9XG4gICAgY29uc3QgYXJjaGl2byA9IGBjdXJzb3NfJHtNYXRoLmZsb29yKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCl9Lnhsc3hgXG4gICAgY29uc3QgbGlicm8gPSBuZXcgRXhjZWwuV29ya2Jvb2soKVxuICAgIGNvbnN0IGhvamEgPSBsaWJyby5hZGRXb3Jrc2hlZXQoJ0N1cnNvcycpXG4gICAgaG9qYS5jb2x1bW5zID0gW1xuICAgICAgeyBrZXk6ICdpZGlvbWFOb21icmUnLCBoZWFkZXI6ICdJZGlvbWEnLCB9LFxuICAgICAgeyBrZXk6ICdtb2RhbGlkYWROb21icmUnLCBoZWFkZXI6ICdNb2RhbGlkYWQnLCB9LFxuICAgICAgeyBrZXk6ICdub21icmUnLCBoZWFkZXI6ICdOb21icmUnLCB9LFxuICAgICAgeyBrZXk6ICdob3JhSW5pY2lhbCcsIGhlYWRlcjogJ0hvcmEgSW5pY2lhbCcsIH0sXG4gICAgICB7IGtleTogJ2hvcmFGaW5hbCcsIGhlYWRlcjogJ0hvcmEgRmluYWwnLCB9LFxuICAgICAgeyBrZXk6ICdlc3RhZG8nLCBoZWFkZXI6ICdFc3RhZG8nLCB9LFxuICAgICAgeyBrZXk6ICduaXZlbGVzTGlzdGEnLCBoZWFkZXI6ICdOaXZlbGVzJywgfSxcbiAgICAgIHsga2V5OiAnbGlicm9zTGlzdGEnLCBoZWFkZXI6ICdMaWJyb3MnLCB9LFxuICAgIF07XG4gICAgaG9qYS5nZXRSb3coMSkuZm9udCA9IHtcbiAgICAgIGJvbGQ6IHRydWUsXG4gICAgfTtcblxuICAgIChhd2FpdCBwcmlzbWEuY3Vyc28uZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgZmlsaWFsOiB7XG4gICAgICAgICAgaWQ6IGZpbGlhbElkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgaWRpb21hOiB0cnVlLFxuICAgICAgICBtb2RhbGlkYWQ6IHRydWUsXG4gICAgICAgIG5pdmVsZXM6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBsaWJyb3M6IHtcbiAgICAgICAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgICAgICAgIHsgbm9tYnJlOiAnYXNjJyB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KSkuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGxldCBsaWJyb3NDdXJzbzogQXJyYXk8QXJyYXk8c3RyaW5nPj4gPSBbXVxuICAgICAgaXRlbS5uaXZlbGVzLmZvckVhY2gobml2ZWwgPT4ge1xuICAgICAgICBsaWJyb3NDdXJzby5wdXNoKG5pdmVsLmxpYnJvcy5yZWR1Y2UoZnVuY3Rpb24oYWNjOiBBcnJheTxzdHJpbmc+LCBvKSB7XG4gICAgICAgICAgYWNjLnB1c2goby5ub21icmUpXG4gICAgICAgICAgcmV0dXJuIGFjY1xuICAgICAgICB9LCBbXSkpXG4gICAgICB9KVxuICAgICAgY29uc3QgbGlicm9zTGlzdGEgPSBsaWJyb3NDdXJzby5mbGF0KDEpLmZpbHRlcigodmFsdWUsIGluZGV4LCBhcnJheSkgPT4gYXJyYXkuaW5kZXhPZih2YWx1ZSkgPT09IGluZGV4KS5qb2luKCcsICcpXG4gICAgICBob2phLmFkZFJvdyh7XG4gICAgICAgIGlkaW9tYU5vbWJyZTogaXRlbS5pZGlvbWEubm9tYnJlLFxuICAgICAgICBtb2RhbGlkYWROb21icmU6IGl0ZW0ubW9kYWxpZGFkLm5vbWJyZSxcbiAgICAgICAgbm9tYnJlOiBpdGVtLm5vbWJyZSxcbiAgICAgICAgaG9yYUluaWNpYWw6IGl0ZW0uaG9yYUluaWNpYWwsXG4gICAgICAgIGhvcmFGaW5hbDogaXRlbS5ob3JhRmluYWwsXG4gICAgICAgIGVzdGFkbzogaXRlbS5hY3Rpdm8gPyAnRU4gQ1VSU08nIDogJ0ZJTkFMSVpBRE8nLFxuICAgICAgICBuaXZlbGVzTGlzdGE6IGl0ZW0ubml2ZWxlcy5yZWR1Y2UoZnVuY3Rpb24oYWNjOiBBcnJheTxzdHJpbmc+LCBvKSB7XG4gICAgICAgICAgYWNjLnB1c2goby5ub21icmUpXG4gICAgICAgICAgcmV0dXJuIGFjY1xuICAgICAgICB9LCBbXSkuam9pbignLCAnKSxcbiAgICAgICAgbGlicm9zTGlzdGE6IGxpYnJvc0xpc3RhLFxuICAgICAgfSlcbiAgICB9KVxuICAgIGF3YWl0IHJlc3BvbnNlLmhlYWRlcignY29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JylcbiAgICBhd2FpdCByZXNwb25zZS5oZWFkZXIoJ2NvbnRlbnQtZGlzcG9zaXRpb24nLCBgYXR0YWNobWVudDsgZmlsZW5hbWU9JHthcmNoaXZvfWApXG4gICAgYXdhaXQgbGlicm8ueGxzeC53cml0ZUZpbGUoYCR7ZGlyfS8ke2FyY2hpdm99YClcbiAgICByZXR1cm4gcmVzcG9uc2UuZG93bmxvYWQoYCR7ZGlyfS8ke2FyY2hpdm99YCwgdHJ1ZSwgKGVycikgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBMb2dnZXIuZXJyb3IoZXJyLm1lc3NhZ2UpXG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAwKS5zZW5kKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgZ2VuZXJhciBlbCBhcmNoaXZvJyxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIGZzLnVubGlua1N5bmMoYCR7ZGlyfS8ke2FyY2hpdm99YClcbiAgICB9KVxuICB9XG59XG4iXX0=