"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Prisma_1 = global[Symbol.for('ioc.use')]("Adonis/Addons/Prisma");
class PermisoMiddleware {
    async handle({ auth, response }, next, props) {
        const rol = await Prisma_1.prisma.rol.findFirst({
            where: {
                id: auth.user?.rolId,
            },
            select: {
                id: true,
                nombre: true,
                modulos: true,
            }
        });
        if (rol) {
            if (rol.modulos.some(o => props.includes(o.nombre))) {
                return next();
            }
            else {
                return response.status(401).json({
                    message: 'Acceso no autorizado',
                });
            }
        }
        else {
            return response.status(401).json({
                message: 'Acceso denegado',
            });
        }
    }
}
exports.default = PermisoMiddleware;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGVybWlzb01pZGRsZXdhcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJQZXJtaXNvTWlkZGxld2FyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHVFQUFrRDtBQUVsRCxNQUFxQixpQkFBaUI7SUFDN0IsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQXVCLEVBQUUsSUFBeUIsRUFBRSxLQUFLO1FBQzNGLE1BQU0sR0FBRyxHQUFHLE1BQU0sZUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUM7WUFDckMsS0FBSyxFQUFFO2dCQUNMLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUs7YUFDckI7WUFDRCxNQUFNLEVBQUU7Z0JBQ04sRUFBRSxFQUFFLElBQUk7Z0JBQ1IsTUFBTSxFQUFFLElBQUk7Z0JBQ1osT0FBTyxFQUFFLElBQUk7YUFDZDtTQUNGLENBQUMsQ0FBQTtRQUNGLElBQUksR0FBRyxFQUFFO1lBQ1AsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUU7Z0JBQ25ELE9BQU8sSUFBSSxFQUFFLENBQUE7YUFDZDtpQkFBTTtnQkFDTCxPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMvQixPQUFPLEVBQUUsc0JBQXNCO2lCQUNoQyxDQUFDLENBQUE7YUFDSDtTQUNGO2FBQU07WUFDTCxPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUMvQixPQUFPLEVBQUUsaUJBQWlCO2FBQzNCLENBQUMsQ0FBQTtTQUNIO0lBQ0gsQ0FBQztDQUNGO0FBMUJELG9DQTBCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSHR0cENvbnRleHRDb250cmFjdCB9IGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvSHR0cENvbnRleHQnXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAaW9jOkFkb25pcy9BZGRvbnMvUHJpc21hJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQZXJtaXNvTWlkZGxld2FyZSB7XG4gIHB1YmxpYyBhc3luYyBoYW5kbGUoeyBhdXRoLCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0LCBuZXh0OiAoKSA9PiBQcm9taXNlPHZvaWQ+LCBwcm9wcykge1xuICAgIGNvbnN0IHJvbCA9IGF3YWl0IHByaXNtYS5yb2wuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBhdXRoLnVzZXI/LnJvbElkLFxuICAgICAgfSxcbiAgICAgIHNlbGVjdDoge1xuICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgbm9tYnJlOiB0cnVlLFxuICAgICAgICBtb2R1bG9zOiB0cnVlLFxuICAgICAgfVxuICAgIH0pXG4gICAgaWYgKHJvbCkge1xuICAgICAgaWYgKHJvbC5tb2R1bG9zLnNvbWUobyA9PiBwcm9wcy5pbmNsdWRlcyhvLm5vbWJyZSkpKSB7XG4gICAgICAgIHJldHVybiBuZXh0KClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNvIG5vIGF1dG9yaXphZG8nLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdBY2Nlc28gZGVuZWdhZG8nLFxuICAgICAgfSlcbiAgICB9XG4gIH1cbn1cbiJdfQ==