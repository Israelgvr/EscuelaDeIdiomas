"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Validator_1 = global[Symbol.for('ioc.use')]("Adonis/Core/Validator");
const Prisma_1 = global[Symbol.for('ioc.use')]("Adonis/Addons/Prisma");
const Logger_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Core/Logger"));
class InscripcionesController {
    async index({ request, response }) {
        const pagina = parseInt(request.input('pagina') || 1);
        const porPagina = parseInt(request.input('porPagina') || 8);
        const buscar = request.input('buscar') || '';
        const filtroCurso = request.input('cursoId') || '';
        const filialId = request.input('filialId') || '';
        if (filialId == '') {
            return response.status(422).send({
                message: 'Debe seleccionar una filial',
            });
        }
        if (filtroCurso != '') {
            const [data, total] = await Prisma_1.prisma.$transaction([
                Prisma_1.prisma.inscripcion.findMany({
                    skip: (pagina - 1) * porPagina,
                    take: porPagina,
                    include: {
                        tipoEstudiante: true,
                        traspasoFilial: true,
                        estudiante: {
                            include: {
                                fuerza: true,
                                persona: {
                                    include: {
                                        ciudad: true,
                                        parentesco: true,
                                    },
                                },
                            },
                        },
                        curso: {
                            include: {
                                idioma: true,
                            },
                        },
                    },
                    orderBy: {
                        estudiante: {
                            persona: {
                                nombre: 'asc',
                            }
                        },
                    },
                    where: {
                        curso: {
                            id: filtroCurso,
                        },
                        filial: {
                            id: filialId,
                        },
                        estudiante: {
                            OR: [
                                {
                                    matricula: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                }, {
                                    persona: {
                                        OR: [
                                            {
                                                apellidoPaterno: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            }, {
                                                apellidoMaterno: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            }, {
                                                nombre: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            },
                                        ],
                                    },
                                },
                            ],
                        },
                    },
                }),
                Prisma_1.prisma.inscripcion.count({
                    where: {
                        curso: {
                            id: filtroCurso,
                        },
                        filial: {
                            id: filialId,
                        },
                        estudiante: {
                            OR: [
                                {
                                    matricula: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                }, {
                                    persona: {
                                        OR: [
                                            {
                                                apellidoPaterno: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            }, {
                                                apellidoMaterno: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            }, {
                                                nombre: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            },
                                        ],
                                    },
                                },
                            ],
                        },
                    },
                })
            ]);
            return response.send({
                message: 'Lista de registros',
                payload: {
                    data: data,
                    meta: {
                        lastPage: Math.ceil(total / porPagina),
                        total: total,
                    }
                },
            });
        }
        else {
            const [data, total] = await Prisma_1.prisma.$transaction([
                Prisma_1.prisma.inscripcion.findMany({
                    skip: (pagina - 1) * porPagina,
                    take: porPagina,
                    include: {
                        tipoEstudiante: true,
                        traspasoFilial: true,
                        estudiante: {
                            include: {
                                fuerza: true,
                                persona: {
                                    include: {
                                        ciudad: true,
                                        parentesco: true,
                                    },
                                },
                            },
                        },
                        curso: {
                            include: {
                                idioma: true,
                            },
                        },
                    },
                    orderBy: {
                        estudiante: {
                            persona: {
                                nombre: 'asc',
                            }
                        },
                    },
                    where: {
                        filial: {
                            id: filialId,
                        },
                        estudiante: {
                            OR: [
                                {
                                    matricula: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                }, {
                                    persona: {
                                        OR: [
                                            {
                                                apellidoPaterno: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            }, {
                                                apellidoMaterno: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            }, {
                                                nombre: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            },
                                        ],
                                    },
                                },
                            ],
                        },
                    },
                }),
                Prisma_1.prisma.inscripcion.count({
                    where: {
                        filial: {
                            id: filialId,
                        },
                        estudiante: {
                            OR: [
                                {
                                    matricula: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                }, {
                                    persona: {
                                        OR: [
                                            {
                                                apellidoPaterno: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            }, {
                                                apellidoMaterno: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            }, {
                                                nombre: {
                                                    contains: buscar,
                                                    mode: 'insensitive',
                                                },
                                            },
                                        ],
                                    },
                                },
                            ],
                        },
                    },
                })
            ]);
            return response.send({
                message: 'Lista de registros',
                payload: {
                    data: data,
                    meta: {
                        lastPage: Math.ceil(total / porPagina),
                        total: total,
                    }
                },
            });
        }
    }
    async indexA({ request, response }) {
        const pagina = parseInt(request.input('pagina') || 1);
        const porPagina = parseInt(request.input('porPagina') || 8);
        const buscar = request.input('buscar') || '';
        const [data, total] = await Prisma_1.prisma.$transaction([
            Prisma_1.prisma.inscripcion.findMany({
                skip: (pagina - 1) * porPagina,
                take: porPagina,
                include: {
                    tipoEstudiante: true,
                    filial: true,
                    estudiante: {
                        include: {
                            fuerza: true,
                            persona: {
                                include: {
                                    ciudad: true,
                                    parentesco: true,
                                },
                            },
                        },
                    },
                },
                orderBy: {
                    estudiante: {
                        persona: {
                            apellidoPaterno: 'asc',
                        },
                    },
                },
                where: {
                    cursoId: request.param('cursoId'),
                    estudiante: {
                        persona: {
                            OR: [
                                {
                                    apellidoPaterno: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                }, {
                                    apellidoMaterno: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                }, {
                                    nombre: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                },
                            ],
                        },
                    },
                },
            }),
            Prisma_1.prisma.inscripcion.count({
                where: {
                    cursoId: request.param('cursoId'),
                    estudiante: {
                        persona: {
                            OR: [
                                {
                                    apellidoPaterno: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                }, {
                                    apellidoMaterno: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                }, {
                                    nombre: {
                                        contains: buscar,
                                        mode: 'insensitive',
                                    },
                                },
                            ],
                        },
                    },
                },
            })
        ]);
        return response.send({
            message: 'Lista de registros',
            payload: {
                data: data,
                meta: {
                    lastPage: Math.ceil(total / porPagina),
                    total: total,
                }
            },
        });
    }
    async store({ request, response }) {
        const payload = await request.validate({
            schema: Validator_1.schema.create({
                deposito: Validator_1.schema.boolean(),
                numeroDeposito: Validator_1.schema.string.nullable([
                    Validator_1.rules.maxLength(255),
                    Validator_1.rules.trim(),
                ]),
                traspaso: Validator_1.schema.boolean(),
                traspasoFilialId: Validator_1.schema.string.nullable([
                    Validator_1.rules.requiredWhen('traspaso', '=', true),
                ]),
                estudianteId: Validator_1.schema.string(),
                tipoEstudianteId: Validator_1.schema.string(),
                descuentoPorcentaje: Validator_1.schema.number([
                    Validator_1.rules.range(0, 100),
                ]),
                filialId: Validator_1.schema.string(),
                cursoId: Validator_1.schema.string(),
            }),
            messages: {
                'filialId.requiredWhen': 'La filial de traspaso es requerida',
            }
        });
        const registro = await Prisma_1.prisma.inscripcion.findFirst({
            where: {
                cursoId: payload.cursoId,
                estudianteId: payload.estudianteId,
            },
        });
        if (registro !== null) {
            return response.status(422).send({
                message: 'Registro duplicado',
                errors: {
                    estudianteId: ['El estudiante ya estÃ¡ inscrito en el curso'],
                },
            });
        }
        try {
            const inscripcion = await Prisma_1.prisma.inscripcion.create({
                data: {
                    deposito: payload.deposito,
                    numeroDeposito: payload.numeroDeposito,
                    traspaso: payload.traspaso,
                    estudiante: {
                        connect: { id: payload.estudianteId },
                    },
                    tipoEstudiante: {
                        connect: { id: payload.tipoEstudianteId },
                    },
                    curso: {
                        connect: { id: payload.cursoId },
                    },
                    descuentoPorcentaje: payload.descuentoPorcentaje,
                    descuento: 0,
                    filial: {
                        connect: { id: payload.filialId },
                    },
                },
            });
            if (payload.traspaso && payload.traspasoFilialId) {
                await Prisma_1.prisma.inscripcion.update({
                    where: {
                        id: inscripcion.id,
                    },
                    data: {
                        traspasoFilial: {
                            connect: { id: payload.traspasoFilialId },
                        },
                    },
                });
            }
            return response.send({
                message: 'Registro almacenado',
                payload: inscripcion,
            });
        }
        catch (err) {
            return response.status(500).send({
                message: 'Error al almacenar el registro',
            });
        }
    }
    async show({ request, response }) {
        try {
            return response.send({
                message: 'Detalle del registro',
                payload: await Prisma_1.prisma.inscripcion.findUniqueOrThrow({
                    where: {
                        id: request.param('inscripcionId'),
                    },
                    include: {
                        tipoEstudiante: true,
                        traspasoFilial: true,
                        estudiante: {
                            include: {
                                fuerza: true,
                                persona: {
                                    include: {
                                        ciudad: true,
                                        parentesco: true,
                                    },
                                },
                            },
                        },
                        curso: {
                            include: {
                                idioma: true,
                                modalidad: true,
                                niveles: {
                                    include: {
                                        libros: {
                                            orderBy: [
                                                { nombre: 'asc' },
                                            ],
                                        },
                                    },
                                },
                            },
                        },
                    },
                }),
            });
        }
        catch (err) {
            Logger_1.default.error(err);
            return response.status(404).send({
                message: 'Registro inexistente',
            });
        }
    }
    async update({ request, response }) {
        if ((await Prisma_1.prisma.inscripcion.count({
            where: {
                id: request.param('inscripcionId'),
            },
        })) !== 1) {
            return response.status(404).send({
                message: 'Registro inexistente',
            });
        }
        const payload = await request.validate({
            schema: Validator_1.schema.create({
                deposito: Validator_1.schema.boolean(),
                numeroDeposito: Validator_1.schema.string.nullable([
                    Validator_1.rules.maxLength(255),
                    Validator_1.rules.trim(),
                ]),
                traspaso: Validator_1.schema.boolean(),
                traspasoFilialId: Validator_1.schema.string.nullable([
                    Validator_1.rules.requiredWhen('traspaso', '=', true),
                ]),
                tipoEstudianteId: Validator_1.schema.string(),
                descuentoPorcentaje: Validator_1.schema.number([
                    Validator_1.rules.range(0, 100),
                ]),
                filialId: Validator_1.schema.string(),
                cursoId: Validator_1.schema.string(),
            }),
            messages: {
                'filialId.requiredWhen': 'La filial de traspaso es requerida',
            }
        });
        try {
            const inscripcion = await Prisma_1.prisma.inscripcion.update({
                where: {
                    id: request.param('inscripcionId'),
                },
                data: {
                    deposito: payload.deposito,
                    numeroDeposito: payload.numeroDeposito,
                    traspaso: payload.traspaso,
                    tipoEstudiante: {
                        connect: { id: payload.tipoEstudianteId },
                    },
                    curso: {
                        connect: { id: payload.cursoId },
                    },
                    descuentoPorcentaje: payload.descuentoPorcentaje,
                    descuento: 0,
                    filial: {
                        connect: { id: payload.filialId },
                    },
                },
            });
            if (payload.traspaso && payload.traspasoFilialId) {
                await Prisma_1.prisma.inscripcion.update({
                    where: {
                        id: inscripcion.id,
                    },
                    data: {
                        traspasoFilial: {
                            connect: { id: payload.traspasoFilialId },
                        },
                    },
                });
            }
            else {
                await Prisma_1.prisma.inscripcion.update({
                    where: {
                        id: inscripcion.id,
                    },
                    data: {
                        traspasoFilial: {
                            disconnect: true,
                        },
                    },
                });
            }
            return response.send({
                message: 'Registro actualizado',
                payload: inscripcion,
            });
        }
        catch (err) {
            Logger_1.default.error(err);
            return response.status(500).send({
                message: 'Error al almacenar el registro',
            });
        }
    }
    async destroy({ request, response }) {
        if ((await Prisma_1.prisma.inscripcion.count({
            where: {
                id: request.param('inscripcionId'),
            },
        })) !== 1) {
            return response.status(404).send({
                message: 'Registro inexistente',
            });
        }
        await Prisma_1.prisma.inscripcion.delete({
            where: {
                id: request.param('inscripcionId'),
            },
        });
        return response.send({
            message: 'Registro eliminado',
        });
    }
    async estudiantes({ request, response }) {
        const filialId = request.input('filialId') || '';
        if (filialId == '') {
            return response.status(422).send({
                message: 'Debe seleccionar una filial',
            });
        }
        const cursoId = request.input('cursoId') || '';
        if (cursoId == '') {
            return response.status(422).send({
                message: 'Debe seleccionar un curso',
            });
        }
        const buscar = request.input('buscar') || '';
        let inscritos = [];
        try {
            const curso = await Prisma_1.prisma.curso.findUniqueOrThrow({
                where: {
                    id: cursoId,
                },
                include: {
                    inscripciones: {
                        where: {
                            estudiante: {
                                matricula: {
                                    not: null
                                },
                            },
                        },
                        include: {
                            estudiante: true,
                        },
                    },
                },
            });
            if (curso.inscripciones.length > 0) {
                inscritos = curso.inscripciones.map(o => o.estudiante.id);
            }
            return response.send({
                message: 'Estudiantes disponibles',
                payload: await Prisma_1.prisma.estudiante.findMany({
                    include: {
                        tipoEstudiante: true,
                        fuerza: true,
                        persona: {
                            include: {
                                ciudad: true,
                                parentesco: true,
                            },
                        },
                    },
                    where: {
                        filial: {
                            id: filialId,
                        },
                        id: {
                            notIn: inscritos,
                        },
                        OR: [
                            {
                                matricula: {
                                    contains: buscar,
                                    mode: 'insensitive',
                                },
                            }, {
                                persona: {
                                    OR: [
                                        {
                                            apellidoPaterno: {
                                                contains: buscar,
                                                mode: 'insensitive',
                                            },
                                        }, {
                                            apellidoMaterno: {
                                                contains: buscar,
                                                mode: 'insensitive',
                                            },
                                        }, {
                                            nombre: {
                                                contains: buscar,
                                                mode: 'insensitive',
                                            },
                                        },
                                    ],
                                },
                            },
                        ],
                    },
                })
            });
        }
        catch (err) {
            Logger_1.default.error(err);
            return response.status(404).send({
                message: 'Registro inexistente',
            });
        }
    }
}
exports.default = InscripcionesController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5zY3JpcGNpb25lc0NvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJJbnNjcmlwY2lvbmVzQ29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLDJFQUEwRDtBQUMxRCx1RUFBa0Q7QUFDbEQsc0ZBQTRDO0FBRTVDLE1BQXFCLHVCQUF1QjtJQUduQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBdUI7UUFDM0QsTUFBTSxNQUFNLEdBQVcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDN0QsTUFBTSxTQUFTLEdBQVcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDbkUsTUFBTSxNQUFNLEdBQVcsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDcEQsTUFBTSxXQUFXLEdBQVcsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDMUQsTUFBTSxRQUFRLEdBQVcsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDeEQsSUFBSSxRQUFRLElBQUksRUFBRSxFQUFFO1lBQ2xCLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQy9CLE9BQU8sRUFBRSw2QkFBNkI7YUFDdkMsQ0FBQyxDQUFBO1NBQ0g7UUFFRCxJQUFJLFdBQVcsSUFBSSxFQUFFLEVBQUU7WUFDckIsTUFBTSxDQUFFLElBQUksRUFBRSxLQUFLLENBQUUsR0FBRyxNQUFNLGVBQU0sQ0FBQyxZQUFZLENBQUM7Z0JBQ2hELGVBQU0sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDO29CQUMxQixJQUFJLEVBQUUsQ0FBQyxNQUFNLEdBQUcs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TyxFQUFFO29DQUNQLEVBQUUsRUFBRTt3Q0FDRjs0Q0FDRSxlQUFlLEVBQUU7Z0RBQ2YsUUFBUSxFQUFFLE1BQU07Z0RBQ2hCLElBQUksRUFBRSxhQUFhOzZDQUNwQjt5Q0FDRixFQUFFOzRDQUNELGVBQWUsRUFBRTtnREFDZixRQUFRLEVBQUUsTUFBTTtnREFDaEIsSUFBSSxFQUFFLGFBQWE7NkNBQ3BCO3lDQUNGLEVBQUU7NENBQ0QsTUFBTSxFQUFFO2dEQUNOLFFBQVEsRUFBRSxNQUFNO2dEQUNoQixJQUFJLEVBQUUsYUFBYTs2Q0FDcEI7eUNBQ0Y7cUNBQ0Y7aUNBQ0Y7NkJBQ0Y7eUJBQ0Y7cUJBQ0Y7aUJBQ0YsQ0FBQzthQUNILENBQUMsQ0FBQTtTQUNIO1FBQUMsT0FBTSxHQUFHLEVBQUU7WUFDWCxnQkFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUNqQixPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUMvQixPQUFPLEVBQUUsc0JBQXNCO2FBQ2hDLENBQUMsQ0FBQTtTQUNIO0lBQ0gsQ0FBQztDQUNGO0FBM3JCRCwwQ0EyckJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBIdHRwQ29udGV4dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcbmltcG9ydCB7IHNjaGVtYSwgcnVsZXMgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL1ZhbGlkYXRvcidcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0Bpb2M6QWRvbmlzL0FkZG9ucy9QcmlzbWEnXG5pbXBvcnQgTG9nZ2VyIGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvTG9nZ2VyJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJbnNjcmlwY2lvbmVzQ29udHJvbGxlciB7XG5cblxuICBwdWJsaWMgYXN5bmMgaW5kZXgoeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgcGFnaW5hOiBudW1iZXIgPSBwYXJzZUludChyZXF1ZXN0LmlucHV0KCdwYWdpbmEnKSB8fCAxKVxuICAgIGNvbnN0IHBvclBhZ2luYTogbnVtYmVyID0gcGFyc2VJbnQocmVxdWVzdC5pbnB1dCgncG9yUGFnaW5hJykgfHwgOClcbiAgICBjb25zdCBidXNjYXI6IHN0cmluZyA9IHJlcXVlc3QuaW5wdXQoJ2J1c2NhcicpIHx8ICcnXG4gICAgY29uc3QgZmlsdHJvQ3Vyc286IHN0cmluZyA9IHJlcXVlc3QuaW5wdXQoJ2N1cnNvSWQnKSB8fCAnJ1xuICAgIGNvbnN0IGZpbGlhbElkOiBzdHJpbmcgPSByZXF1ZXN0LmlucHV0KCdmaWxpYWxJZCcpIHx8ICcnXG4gICAgaWYgKGZpbGlhbElkID09ICcnKSB7XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQyMikuc2VuZCh7XG4gICAgICAgIG1lc3NhZ2U6ICdEZWJlIHNlbGVjY2lvbmFyIHVuYSBmaWxpYWwnLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBpZiAoZmlsdHJvQ3Vyc28gIT0gJycpIHtcbiAgICAgIGNvbnN0IFsgZGF0YSwgdG90YWwgXSA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oW1xuICAgICAgICBwcmlzbWEuaW5zY3JpcGNpb24uZmluZE1hbnkoe1xuICAgICAgICAgIHNraXA6IChwYWdpbmEgLSAxKSAqIHBvclBhZ2luYSxcbiAgICAgICAgICB0YWtlOiBwb3JQYWdpbmEsXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdGlwb0VzdHVkaWFudGU6IHRydWUsXG4gICAgICAgICAgICB0cmFzcGFzb0ZpbGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIGVzdHVkaWFudGU6IHtcbiAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIGZ1ZXJ6YTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwZXJzb25hOiB7XG4gICAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNpdWRhZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50ZXNjbzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjdXJzbzoge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgaWRpb21hOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICAgIGVzdHVkaWFudGU6IHtcbiAgICAgICAgICAgICAgcGVyc29uYToge1xuICAgICAgICAgICAgICAgIG5vbWJyZTogJ2FzYycsXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgY3Vyc286IHtcbiAgICAgICAgICAgICAgaWQ6IGZpbHRyb0N1cnNvLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZpbGlhbDoge1xuICAgICAgICAgICAgICBpZDogZmlsaWFsSWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXN0dWRpYW50ZToge1xuICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIG1hdHJpY3VsYToge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICBwZXJzb25hOiB7XG4gICAgICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBlbGxpZG9QYXRlcm5vOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBidXNjYXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwZWxsaWRvTWF0ZXJubzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub21icmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIHByaXNtYS5pbnNjcmlwY2lvbi5jb3VudCh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIGN1cnNvOiB7XG4gICAgICAgICAgICAgIGlkOiBmaWx0cm9DdXJzbyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaWxpYWw6IHtcbiAgICAgICAgICAgICAgaWQ6IGZpbGlhbElkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVzdHVkaWFudGU6IHtcbiAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBtYXRyaWN1bGE6IHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgcGVyc29uYToge1xuICAgICAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwZWxsaWRvUGF0ZXJubzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcGVsbGlkb01hdGVybm86IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9tYnJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBidXNjYXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG4gICAgICBdKVxuICAgICAgcmV0dXJuIHJlc3BvbnNlLnNlbmQoe1xuICAgICAgICBtZXNzYWdlOiAnTGlzdGEgZGUgcmVnaXN0cm9zJyxcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgbWV0YToge1xuICAgICAgICAgICAgbGFzdFBhZ2U6IE1hdGguY2VpbCh0b3RhbC9wb3JQYWdpbmEpLFxuICAgICAgICAgICAgdG90YWw6IHRvdGFsLFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IFsgZGF0YSwgdG90YWwgXSA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oW1xuICAgICAgICBwcmlzbWEuaW5zY3JpcGNpb24uZmluZE1hbnkoe1xuICAgICAgICAgIHNraXA6IChwYWdpbmEgLSAxKSAqIHBvclBhZ2luYSxcbiAgICAgICAgICB0YWtlOiBwb3JQYWdpbmEsXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdGlwb0VzdHVkaWFudGU6IHRydWUsXG4gICAgICAgICAgICB0cmFzcGFzb0ZpbGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIGVzdHVkaWFudGU6IHtcbiAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIGZ1ZXJ6YTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwZXJzb25hOiB7XG4gICAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNpdWRhZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50ZXNjbzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjdXJzbzoge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgaWRpb21hOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICAgIGVzdHVkaWFudGU6IHtcbiAgICAgICAgICAgICAgcGVyc29uYToge1xuICAgICAgICAgICAgICAgIG5vbWJyZTogJ2FzYycsXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgZmlsaWFsOiB7XG4gICAgICAgICAgICAgIGlkOiBmaWxpYWxJZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlc3R1ZGlhbnRlOiB7XG4gICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgbWF0cmljdWxhOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBidXNjYXIsXG4gICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgIHBlcnNvbmE6IHtcbiAgICAgICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcGVsbGlkb1BhdGVybm86IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBlbGxpZG9NYXRlcm5vOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBidXNjYXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vbWJyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgcHJpc21hLmluc2NyaXBjaW9uLmNvdW50KHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgZmlsaWFsOiB7XG4gICAgICAgICAgICAgIGlkOiBmaWxpYWxJZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlc3R1ZGlhbnRlOiB7XG4gICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgbWF0cmljdWxhOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBidXNjYXIsXG4gICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgIHBlcnNvbmE6IHtcbiAgICAgICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcGVsbGlkb1BhdGVybm86IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBlbGxpZG9NYXRlcm5vOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBidXNjYXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vbWJyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgXSlcbiAgICAgIHJldHVybiByZXNwb25zZS5zZW5kKHtcbiAgICAgICAgbWVzc2FnZTogJ0xpc3RhIGRlIHJlZ2lzdHJvcycsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgIG1ldGE6IHtcbiAgICAgICAgICAgIGxhc3RQYWdlOiBNYXRoLmNlaWwodG90YWwvcG9yUGFnaW5hKSxcbiAgICAgICAgICAgIHRvdGFsOiB0b3RhbCxcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBpbmRleEEoeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgcGFnaW5hOiBudW1iZXIgPSBwYXJzZUludChyZXF1ZXN0LmlucHV0KCdwYWdpbmEnKSB8fCAxKVxuICAgIGNvbnN0IHBvclBhZ2luYTogbnVtYmVyID0gcGFyc2VJbnQocmVxdWVzdC5pbnB1dCgncG9yUGFnaW5hJykgfHwgOClcbiAgICBjb25zdCBidXNjYXI6IHN0cmluZyA9IHJlcXVlc3QuaW5wdXQoJ2J1c2NhcicpIHx8ICcnXG5cbiAgICBjb25zdCBbIGRhdGEsIHRvdGFsIF0gPSBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKFtcbiAgICAgIHByaXNtYS5pbnNjcmlwY2lvbi5maW5kTWFueSh7XG4gICAgICAgIHNraXA6IChwYWdpbmEgLSAxKSAqIHBvclBhZ2luYSxcbiAgICAgICAgdGFrZTogcG9yUGFnaW5hLFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdGlwb0VzdHVkaWFudGU6IHRydWUsXG4gICAgICAgICAgZmlsaWFsOiB0cnVlLFxuICAgICAgICAgIGVzdHVkaWFudGU6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgZnVlcnphOiB0cnVlLFxuICAgICAgICAgICAgICBwZXJzb25hOiB7XG4gICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgY2l1ZGFkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgcGFyZW50ZXNjbzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgZXN0dWRpYW50ZToge1xuICAgICAgICAgICAgcGVyc29uYToge1xuICAgICAgICAgICAgICBhcGVsbGlkb1BhdGVybm86ICdhc2MnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGN1cnNvSWQ6IHJlcXVlc3QucGFyYW0oJ2N1cnNvSWQnKSxcbiAgICAgICAgICBlc3R1ZGlhbnRlOiB7XG4gICAgICAgICAgICBwZXJzb25hOiB7XG4gICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgYXBlbGxpZG9QYXRlcm5vOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBidXNjYXIsXG4gICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgIGFwZWxsaWRvTWF0ZXJubzoge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICBub21icmU6IHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgcHJpc21hLmluc2NyaXBjaW9uLmNvdW50KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBjdXJzb0lkOiByZXF1ZXN0LnBhcmFtKCdjdXJzb0lkJyksXG4gICAgICAgICAgZXN0dWRpYW50ZToge1xuICAgICAgICAgICAgcGVyc29uYToge1xuICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGFwZWxsaWRvUGF0ZXJubzoge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICBhcGVsbGlkb01hdGVybm86IHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgbm9tYnJlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBidXNjYXIsXG4gICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgIF0pXG4gICAgcmV0dXJuIHJlc3BvbnNlLnNlbmQoe1xuICAgICAgbWVzc2FnZTogJ0xpc3RhIGRlIHJlZ2lzdHJvcycsXG4gICAgICBwYXlsb2FkOiB7XG4gICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgIG1ldGE6IHtcbiAgICAgICAgICBsYXN0UGFnZTogTWF0aC5jZWlsKHRvdGFsL3BvclBhZ2luYSksXG4gICAgICAgICAgdG90YWw6IHRvdGFsLFxuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0pXG4gIH1cblxuXG5cbiAgcHVibGljIGFzeW5jIHN0b3JlKHsgcmVxdWVzdCwgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgIGNvbnN0IHBheWxvYWQgPSBhd2FpdCByZXF1ZXN0LnZhbGlkYXRlKHtcbiAgICAgIHNjaGVtYTogc2NoZW1hLmNyZWF0ZSh7XG4gICAgICAgIGRlcG9zaXRvOiBzY2hlbWEuYm9vbGVhbigpLFxuICAgICAgICBudW1lcm9EZXBvc2l0bzogc2NoZW1hLnN0cmluZy5udWxsYWJsZShbXG4gICAgICAgICAgcnVsZXMubWF4TGVuZ3RoKDI1NSksXG4gICAgICAgICAgcnVsZXMudHJpbSgpLFxuICAgICAgICBdKSxcbiAgICAgICAgdHJhc3Bhc286IHNjaGVtYS5ib29sZWFuKCksXG4gICAgICAgIHRyYXNwYXNvRmlsaWFsSWQ6IHNjaGVtYS5zdHJpbmcubnVsbGFibGUoW1xuICAgICAgICAgIHJ1bGVzLnJlcXVpcmVkV2hlbigndHJhc3Bhc28nLCAnPScsIHRydWUpLFxuICAgICAgICBdKSxcbiAgICAgICAgZXN0dWRpYW50ZUlkOiBzY2hlbWEuc3RyaW5nKCksXG4gICAgICAgIHRpcG9Fc3R1ZGlhbnRlSWQ6IHNjaGVtYS5zdHJpbmcoKSxcbiAgICAgICAgZGVzY3VlbnRvUG9yY2VudGFqZTogc2NoZW1hLm51bWJlcihbXG4gICAgICAgICAgcnVsZXMucmFuZ2UoMCwgMTAwKSxcbiAgICAgICAgXSksXG4gICAgICAgIGZpbGlhbElkOiBzY2hlbWEuc3RyaW5nKCksXG4gICAgICAgIGN1cnNvSWQ6IHNjaGVtYS5zdHJpbmcoKSxcbiAgICAgIH0pLFxuICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgJ2ZpbGlhbElkLnJlcXVpcmVkV2hlbic6ICdMYSBmaWxpYWwgZGUgdHJhc3Bhc28gZXMgcmVxdWVyaWRhJyxcbiAgICAgIH1cbiAgICB9KVxuICAgIGNvbnN0IHJlZ2lzdHJvID0gYXdhaXQgcHJpc21hLmluc2NyaXBjaW9uLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBjdXJzb0lkOiBwYXlsb2FkLmN1cnNvSWQsXG4gICAgICAgIGVzdHVkaWFudGVJZDogcGF5bG9hZC5lc3R1ZGlhbnRlSWQsXG4gICAgICB9LFxuICAgIH0pXG4gICAgaWYgKHJlZ2lzdHJvICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQyMikuc2VuZCh7XG4gICAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBkdXBsaWNhZG8nLFxuICAgICAgICBlcnJvcnM6IHtcbiAgICAgICAgICBlc3R1ZGlhbnRlSWQ6IFsnRWwgZXN0dWRpYW50ZSB5YSBlc3TDoSBpbnNjcml0byBlbiBlbCBjdXJzbyddLFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGluc2NyaXBjaW9uID0gYXdhaXQgcHJpc21hLmluc2NyaXBjaW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBkZXBvc2l0bzogcGF5bG9hZC5kZXBvc2l0byxcbiAgICAgICAgICBudW1lcm9EZXBvc2l0bzogcGF5bG9hZC5udW1lcm9EZXBvc2l0byxcbiAgICAgICAgICB0cmFzcGFzbzogcGF5bG9hZC50cmFzcGFzbyxcbiAgICAgICAgICBlc3R1ZGlhbnRlOiB7XG4gICAgICAgICAgICBjb25uZWN0OiB7IGlkOiBwYXlsb2FkLmVzdHVkaWFudGVJZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGlwb0VzdHVkaWFudGU6IHtcbiAgICAgICAgICAgIGNvbm5lY3Q6IHsgaWQ6IHBheWxvYWQudGlwb0VzdHVkaWFudGVJZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY3Vyc286IHtcbiAgICAgICAgICAgIGNvbm5lY3Q6IHsgaWQ6IHBheWxvYWQuY3Vyc29JZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVzY3VlbnRvUG9yY2VudGFqZTogcGF5bG9hZC5kZXNjdWVudG9Qb3JjZW50YWplLFxuICAgICAgICAgIC8vIFRPRE86IGNhbGN1bGFyIGRlc2N1ZW50byBlbiBtb250byBlZmVjdGl2b1xuICAgICAgICAgIGRlc2N1ZW50bzogMCxcbiAgICAgICAgICBmaWxpYWw6IHtcbiAgICAgICAgICAgIGNvbm5lY3Q6IHsgaWQ6IHBheWxvYWQuZmlsaWFsSWQgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICAgIGlmIChwYXlsb2FkLnRyYXNwYXNvICYmIHBheWxvYWQudHJhc3Bhc29GaWxpYWxJZCkge1xuICAgICAgICBhd2FpdCBwcmlzbWEuaW5zY3JpcGNpb24udXBkYXRlKHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgaWQ6IGluc2NyaXBjaW9uLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdHJhc3Bhc29GaWxpYWw6IHtcbiAgICAgICAgICAgICAgY29ubmVjdDogeyBpZDogcGF5bG9hZC50cmFzcGFzb0ZpbGlhbElkIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc2VuZCh7XG4gICAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBhbG1hY2VuYWRvJyxcbiAgICAgICAgcGF5bG9hZDogaW5zY3JpcGNpb24sXG4gICAgICB9KVxuICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDUwMCkuc2VuZCh7XG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBhbG1hY2VuYXIgZWwgcmVnaXN0cm8nLFxuICAgICAgfSlcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc2hvdyh7IHJlcXVlc3QsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnNlbmQoe1xuICAgICAgICBtZXNzYWdlOiAnRGV0YWxsZSBkZWwgcmVnaXN0cm8nLFxuICAgICAgICBwYXlsb2FkOiBhd2FpdCBwcmlzbWEuaW5zY3JpcGNpb24uZmluZFVuaXF1ZU9yVGhyb3coe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBpZDogcmVxdWVzdC5wYXJhbSgnaW5zY3JpcGNpb25JZCcpLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdGlwb0VzdHVkaWFudGU6IHRydWUsXG4gICAgICAgICAgICB0cmFzcGFzb0ZpbGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIGVzdHVkaWFudGU6IHtcbiAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIGZ1ZXJ6YTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwZXJzb25hOiB7XG4gICAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNpdWRhZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50ZXNjbzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjdXJzbzoge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgaWRpb21hOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1vZGFsaWRhZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBuaXZlbGVzOiB7XG4gICAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGxpYnJvczoge1xuICAgICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbm9tYnJlOiAnYXNjJyB9LFxuICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSlcbiAgICB9IGNhdGNoKGVycikge1xuICAgICAgTG9nZ2VyLmVycm9yKGVycilcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDA0KS5zZW5kKHtcbiAgICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJvIGluZXhpc3RlbnRlJyxcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHVwZGF0ZSh7IHJlcXVlc3QsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICBpZiAoKGF3YWl0IHByaXNtYS5pbnNjcmlwY2lvbi5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogcmVxdWVzdC5wYXJhbSgnaW5zY3JpcGNpb25JZCcpLFxuICAgICAgfSxcbiAgICB9KSkgIT09IDEpIHtcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDA0KS5zZW5kKHtcbiAgICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJvIGluZXhpc3RlbnRlJyxcbiAgICAgIH0pXG4gICAgfVxuICAgIGNvbnN0IHBheWxvYWQgPSBhd2FpdCByZXF1ZXN0LnZhbGlkYXRlKHtcbiAgICAgIHNjaGVtYTogc2NoZW1hLmNyZWF0ZSh7XG4gICAgICAgIGRlcG9zaXRvOiBzY2hlbWEuYm9vbGVhbigpLFxuICAgICAgICBudW1lcm9EZXBvc2l0bzogc2NoZW1hLnN0cmluZy5udWxsYWJsZShbXG4gICAgICAgICAgcnVsZXMubWF4TGVuZ3RoKDI1NSksXG4gICAgICAgICAgcnVsZXMudHJpbSgpLFxuICAgICAgICBdKSxcbiAgICAgICAgdHJhc3Bhc286IHNjaGVtYS5ib29sZWFuKCksXG4gICAgICAgIHRyYXNwYXNvRmlsaWFsSWQ6IHNjaGVtYS5zdHJpbmcubnVsbGFibGUoW1xuICAgICAgICAgIHJ1bGVzLnJlcXVpcmVkV2hlbigndHJhc3Bhc28nLCAnPScsIHRydWUpLFxuICAgICAgICBdKSxcbiAgICAgICAgdGlwb0VzdHVkaWFudGVJZDogc2NoZW1hLnN0cmluZygpLFxuICAgICAgICBkZXNjdWVudG9Qb3JjZW50YWplOiBzY2hlbWEubnVtYmVyKFtcbiAgICAgICAgICBydWxlcy5yYW5nZSgwLCAxMDApLFxuICAgICAgICBdKSxcbiAgICAgICAgZmlsaWFsSWQ6IHNjaGVtYS5zdHJpbmcoKSxcbiAgICAgICAgY3Vyc29JZDogc2NoZW1hLnN0cmluZygpLFxuICAgICAgfSksXG4gICAgICBtZXNzYWdlczoge1xuICAgICAgICAnZmlsaWFsSWQucmVxdWlyZWRXaGVuJzogJ0xhIGZpbGlhbCBkZSB0cmFzcGFzbyBlcyByZXF1ZXJpZGEnLFxuICAgICAgfVxuICAgIH0pXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGluc2NyaXBjaW9uID0gYXdhaXQgcHJpc21hLmluc2NyaXBjaW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgaWQ6IHJlcXVlc3QucGFyYW0oJ2luc2NyaXBjaW9uSWQnKSxcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGRlcG9zaXRvOiBwYXlsb2FkLmRlcG9zaXRvLFxuICAgICAgICAgIG51bWVyb0RlcG9zaXRvOiBwYXlsb2FkLm51bWVyb0RlcG9zaXRvLFxuICAgICAgICAgIHRyYXNwYXNvOiBwYXlsb2FkLnRyYXNwYXNvLFxuICAgICAgICAgIHRpcG9Fc3R1ZGlhbnRlOiB7XG4gICAgICAgICAgICBjb25uZWN0OiB7IGlkOiBwYXlsb2FkLnRpcG9Fc3R1ZGlhbnRlSWQgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGN1cnNvOiB7XG4gICAgICAgICAgICBjb25uZWN0OiB7IGlkOiBwYXlsb2FkLmN1cnNvSWQgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlc2N1ZW50b1BvcmNlbnRhamU6IHBheWxvYWQuZGVzY3VlbnRvUG9yY2VudGFqZSxcbiAgICAgICAgICAvLyBUT0RPOiBjYWxjdWxhciBkZXNjdWVudG8gZW4gbW9udG8gZWZlY3Rpdm9cbiAgICAgICAgICBkZXNjdWVudG86IDAsXG4gICAgICAgICAgZmlsaWFsOiB7XG4gICAgICAgICAgICBjb25uZWN0OiB7IGlkOiBwYXlsb2FkLmZpbGlhbElkIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgICBpZiAocGF5bG9hZC50cmFzcGFzbyAmJiBwYXlsb2FkLnRyYXNwYXNvRmlsaWFsSWQpIHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmluc2NyaXBjaW9uLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIGlkOiBpbnNjcmlwY2lvbi5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRyYXNwYXNvRmlsaWFsOiB7XG4gICAgICAgICAgICAgIGNvbm5lY3Q6IHsgaWQ6IHBheWxvYWQudHJhc3Bhc29GaWxpYWxJZCB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmluc2NyaXBjaW9uLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIGlkOiBpbnNjcmlwY2lvbi5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRyYXNwYXNvRmlsaWFsOiB7XG4gICAgICAgICAgICAgIGRpc2Nvbm5lY3Q6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc2VuZCh7XG4gICAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBhY3R1YWxpemFkbycsXG4gICAgICAgIHBheWxvYWQ6IGluc2NyaXBjaW9uLFxuICAgICAgfSlcbiAgICB9IGNhdGNoKGVycikge1xuICAgICAgTG9nZ2VyLmVycm9yKGVycilcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNTAwKS5zZW5kKHtcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIGFsIGFsbWFjZW5hciBlbCByZWdpc3RybycsXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBkZXN0cm95KHsgcmVxdWVzdCwgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgIGlmICgoYXdhaXQgcHJpc21hLmluc2NyaXBjaW9uLmNvdW50KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiByZXF1ZXN0LnBhcmFtKCdpbnNjcmlwY2lvbklkJyksXG4gICAgICB9LFxuICAgIH0pKSAhPT0gMSkge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoe1xuICAgICAgICBtZXNzYWdlOiAnUmVnaXN0cm8gaW5leGlzdGVudGUnLFxuICAgICAgfSlcbiAgICB9XG4gICAgYXdhaXQgcHJpc21hLmluc2NyaXBjaW9uLmRlbGV0ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogcmVxdWVzdC5wYXJhbSgnaW5zY3JpcGNpb25JZCcpLFxuICAgICAgfSxcbiAgICB9KVxuICAgIHJldHVybiByZXNwb25zZS5zZW5kKHtcbiAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBlbGltaW5hZG8nLFxuICAgIH0pXG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZXN0dWRpYW50ZXMoeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgZmlsaWFsSWQ6IHN0cmluZyA9IHJlcXVlc3QuaW5wdXQoJ2ZpbGlhbElkJykgfHwgJydcbiAgICBpZiAoZmlsaWFsSWQgPT0gJycpIHtcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDIyKS5zZW5kKHtcbiAgICAgICAgbWVzc2FnZTogJ0RlYmUgc2VsZWNjaW9uYXIgdW5hIGZpbGlhbCcsXG4gICAgICB9KVxuICAgIH1cbiAgICBjb25zdCBjdXJzb0lkOiBzdHJpbmcgPSByZXF1ZXN0LmlucHV0KCdjdXJzb0lkJykgfHwgJydcbiAgICBpZiAoY3Vyc29JZCA9PSAnJykge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyg0MjIpLnNlbmQoe1xuICAgICAgICBtZXNzYWdlOiAnRGViZSBzZWxlY2Npb25hciB1biBjdXJzbycsXG4gICAgICB9KVxuICAgIH1cbiAgICBjb25zdCBidXNjYXI6IHN0cmluZyA9IHJlcXVlc3QuaW5wdXQoJ2J1c2NhcicpIHx8ICcnXG5cbiAgICBsZXQgaW5zY3JpdG9zOiBBcnJheTxzdHJpbmc+ID0gW11cbiAgICB0cnkge1xuICAgICAgY29uc3QgY3Vyc28gPSBhd2FpdCBwcmlzbWEuY3Vyc28uZmluZFVuaXF1ZU9yVGhyb3coe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGlkOiBjdXJzb0lkLFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgaW5zY3JpcGNpb25lczoge1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgZXN0dWRpYW50ZToge1xuICAgICAgICAgICAgICAgIG1hdHJpY3VsYToge1xuICAgICAgICAgICAgICAgICAgbm90OiBudWxsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIGVzdHVkaWFudGU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgaWYgKGN1cnNvLmluc2NyaXBjaW9uZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBpbnNjcml0b3MgPSBjdXJzby5pbnNjcmlwY2lvbmVzLm1hcChvID0+IG8uZXN0dWRpYW50ZS5pZClcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXNwb25zZS5zZW5kKHtcbiAgICAgICAgbWVzc2FnZTogJ0VzdHVkaWFudGVzIGRpc3BvbmlibGVzJyxcbiAgICAgICAgcGF5bG9hZDogYXdhaXQgcHJpc21hLmVzdHVkaWFudGUuZmluZE1hbnkoe1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHRpcG9Fc3R1ZGlhbnRlOiB0cnVlLFxuICAgICAgICAgICAgZnVlcnphOiB0cnVlLFxuICAgICAgICAgICAgcGVyc29uYToge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY2l1ZGFkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBhcmVudGVzY286IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIGZpbGlhbDoge1xuICAgICAgICAgICAgICBpZDogZmlsaWFsSWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgbm90SW46IGluc2NyaXRvcyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbWF0cmljdWxhOiB7XG4gICAgICAgICAgICAgICAgICBjb250YWluczogYnVzY2FyLFxuICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgcGVyc29uYToge1xuICAgICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgIGFwZWxsaWRvUGF0ZXJubzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgIGFwZWxsaWRvTWF0ZXJubzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgIG5vbWJyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGJ1c2NhcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSBjYXRjaChlcnIpIHtcbiAgICAgIExvZ2dlci5lcnJvcihlcnIpXG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDQwNCkuc2VuZCh7XG4gICAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBpbmV4aXN0ZW50ZScsXG4gICAgICB9KVxuICAgIH1cbiAgfVxufVxuIl19